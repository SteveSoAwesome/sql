SELECT
    title,
    revenue,
    rank
FROM (
    SELECT 
        a.title,
        SUM(d.amount) AS revenue,
        DENSE_RANK() OVER(ORDER BY SUM(d.amount) DESC) AS rank
    FROM film a
    JOIN inventory b
        ON a.film_id = b.film_id
    JOIN rental c
        ON b.inventory_id = c.inventory_id
    JOIN payment d
        ON c.rental_id = d.rental_id
    GROUP BY 1
) AS rank_table
WHERE rank <= 10;
